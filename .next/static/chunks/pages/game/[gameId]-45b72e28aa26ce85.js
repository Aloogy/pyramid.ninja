(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[822],{284:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/[gameId]",function(){return l(5907)}])},5907:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>g});var s=l(7876),a=l(4232),r=l(9099),n=l(8230),o=l.n(n),i=l(4050),d=l(8894),c=l(3453);let u=e=>{let{cards:t,onCardSelect:l,showAllCards:r=!1,countdownActive:n=!1,className:o=""}=e,[i,u]=(0,a.useState)([]);(0,a.useEffect)(()=>{t&&u(r?Array(t.length).fill(!0):t.map(e=>e.seen))},[t,r]),(0,a.useEffect)(()=>{!n&&r&&u(t.map(e=>e.seen))},[n,r,t]);let h=e=>{l&&l(e)};return(0,s.jsx)("div",{className:"relative mx-auto ".concat(o),style:{width:"400px",height:"350px"},children:t.map((e,t)=>{let a=(0,c.B5)(t),r=a.x+200-50,n=a.y;return(0,s.jsx)(d.A,{index:e.i,position:{x:r,y:n},faceUp:i[t],draggable:!0,onClick:()=>h(t),className:"transition-transform duration-300 ease-out ".concat(l?"hover:scale-105 cursor-pointer":"")},t)})})},h=e=>{let{players:t,selectedPlayer:l,onSelectPlayer:a,onConfirm:r,onCancel:n,currentCard:o}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full overflow-hidden",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Select Player to Drink!"}),(0,s.jsxs)("p",{className:"mb-6",children:[(0,s.jsxs)("span",{className:"font-semibold",children:["Select a player below to tell them you have ",o," and make them drink."]})," ","They can either believe you and take the drinks or call bullshit."]}),0===t.length?(0,s.jsx)("div",{className:"text-center py-4 text-gray-600",children:(0,s.jsx)("h3",{className:"font-bold",children:"Oh no! No other players to send drinks to! :("})}):(0,s.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-center p-3 rounded-lg cursor-pointer transition-colors ".concat((null==l?void 0:l.uid)===e.uid?"bg-blue-100":"hover:bg-gray-100"),onClick:()=>a(e),children:[(0,s.jsx)("input",{type:"radio",name:"playerSelect",checked:(null==l?void 0:l.uid)===e.uid,onChange:()=>a(e),className:"mr-3"}),(0,s.jsx)("img",{src:"https://us-central1-pyramid-ninja.cloudfunctions.net/avatars/70/".concat(e.name,".png"),alt:"".concat(e.name,"'s avatar"),className:"w-10 h-10 rounded-full mr-3"}),(0,s.jsx)("span",{className:"font-medium",children:e.name})]},e.uid))}),l&&(0,s.jsx)("div",{className:"mt-4 py-2 border-t border-gray-200",children:(0,s.jsxs)("p",{className:"font-semibold",children:["About to send a drink to: ",l.name]})}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{onClick:n,className:"px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg transition duration-200",children:"Cancel"}),(0,s.jsx)("button",{onClick:r,disabled:!l,className:"px-4 py-2 text-white bg-rose-500 rounded-lg transition duration-200 ".concat(l?"hover:bg-rose-600":"opacity-50 cursor-not-allowed"),children:"Confirm"})]})]})})})};var m=l(7187),x=l(4403);let p={notification:1,bullshit:7,success:3,wrong:2},f=()=>{let e=(0,a.useRef)(null),[t,l]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{{e.current=new Audio;let t=localStorage.getItem("pyramid_sound_muted");t&&l("true"===t)}return()=>{e.current&&(e.current.pause(),e.current=null)}},[]),{playSound:l=>{if(!t&&e.current)try{let t=p[l],s=Math.floor(Math.random()*t)+1;e.current.src="/assets/sounds/".concat(l,"/").concat(s,".mp3"),e.current.play().catch(e=>{console.error("Error playing sound:",e)})}catch(e){console.error("Error playing sound:",e)}},isMuted:t,toggleMute:()=>{let e=!t;return l(e),localStorage.setItem("pyramid_sound_muted",e.toString()),e}}},g=()=>{let{gameId:e}=(0,r.useRouter)().query,{gameData:t,players:l}=(0,m.Im)(),{userUid:n}=(0,x.As)(),{playSound:d}=f(),[p,g]=(0,a.useState)(null),[b,w]=(0,a.useState)([]),[y,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)("Waiting for host to continue..."),[_,S]=(0,a.useState)(!1),[k,C]=(0,a.useState)(0),[R,z]=(0,a.useState)(null),[M,E]=(0,a.useState)(null),[T,Y]=(0,a.useState)(null),[B,A]=(0,a.useState)(!1),[H,I]=(0,a.useState)(0),[P,W]=(0,a.useState)(!1),[O,F]=(0,a.useState)(null),[G,L]=(0,a.useState)(!1),[D,U]=(0,a.useState)(!1),[V,X]=(0,a.useState)(!1),[q,J]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),[Z,$]=(0,a.useState)(null),[ee,et]=(0,a.useState)(-1),[el,es]=(0,a.useState)(!1),ea=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=localStorage.getItem("playerName");e&&g(e)},[]),(0,a.useEffect)(()=>{if(k>0)return ea.current=setTimeout(()=>{C(k-1)},1e3),()=>{ea.current&&clearTimeout(ea.current)};0===k&&_&&(S(!1),t&&n&&t[n]&&(w(e=>e.map(e=>({...e,seen:!0}))),N("Waiting for host to continue...")))},[k,_,t,n]),(0,a.useEffect)(()=>{if(!t||!n||!e)return;let s=t[n];if(s){if(s.cards&&w(s.cards),t["__pyramid.meta"].started){var a;v(!0),(null===(a=s.cards)||void 0===a?void 0:a.every(e=>e.seen))||t["__pyramid.currentRound"]||(N("Press the button below to view your cards. You will have just 10 seconds to remember them! Tip: You can drag your cards around to re-order them."),X(!0),U(!1))}else N("Waiting for host to continue..."),l.length>1?L(!0):L(!1);if(t["__pyramid.currentRound"]){let{round_number:e,round_row:s,round_card:a}=t["__pyramid.currentRound"];z(e),E(s),Y((0,c.NR)(a)),X(!1),Q(!1);let r=!0;if(t["__pyramid.rounds"]&&t["__pyramid.rounds"][e]&&t["__pyramid.rounds"][e].round_transactions){let a=t["__pyramid.rounds"][e].round_transactions;a.some(e=>e.t_from===n)&&(r=!1,N("You have sent drinks already - please wait for updates or the round to finish..."));let o=0;a.forEach((e,t)=>{if(e.t_to===n&&"waiting"===e.status){let s=l.find(t=>t.uid===e.t_from);s&&($({from_player:s.name,to_player:p||"You"}),et(t),d("notification"),N("drink"),Q(!0),U(!1),r=!1)}if(e.t_from===n&&"bullshit"===e.status){let s=l.find(t=>t.uid===e.t_to);s&&($({from_player:p||"You",to_player:s.name}),et(t),d("bullshit"),N("bullshit"),A(!0),U(!1),r=!1)}e.t_to===n&&"accepted"===e.status&&(o+=+s),e.t_from===n&&"bullshit_wrong"===e.status&&(o+=2*s),e.t_to===n&&"bullshit_correct"===e.status&&(o+=2*s)}),I(o)}r&&!B&&(N("To call someone to drink use the button below!"),U(!0))}t["__pyramid.summary"]&&(es(!0),N("Game Over! Here are your final cards:"),S(!0))}},[t,n,e,l,p,d]);let er=async()=>{if(n&&e&&O&&null!==R)try{U(!1),W(!1),F(null),N("Waiting for player to respond...")}catch(e){console.error("Failed to call player:",e)}},en=async t=>{if(n&&e&&null!==R&&-1!==ee)try{Q(!1),$(null),t?N("You accepted the drinks!"):N("You called bullshit! The player now needs to show a matching card.")}catch(e){console.error("Failed to process decision:",e)}},eo=async()=>{if(B&&n&&e&&null!==R)try{A(!1),J(!0),N("You showed your card! Click below to get a new card.")}catch(e){console.error("Failed to process bullshit response:",e)}},ei=async()=>{if(e)try{L(!1),N("Starting game...")}catch(e){console.error("Failed to start game:",e)}};return(0,s.jsxs)(i.A,{pageTitle:"Game ".concat(String(e).toUpperCase()),children:[(0,s.jsx)("div",{className:"container mx-auto px-4 pt-6 pb-20",children:(0,s.jsxs)("div",{className:"bg-white bg-opacity-90 rounded-xl shadow-lg overflow-hidden relative",children:[e&&(0,s.jsxs)("div",{className:"absolute top-2 right-2 bg-indigo-800 text-white px-3 py-1 rounded-full text-sm font-bold",children:["Room: ",String(e).toUpperCase()]}),p&&(0,s.jsx)("div",{className:"absolute top-2 left-2 bg-rose-600 text-white px-3 py-1 rounded-full text-sm font-bold",children:p}),k>0&&(0,s.jsxs)("div",{className:"absolute top-10 right-2 bg-amber-500 text-white px-3 py-1 rounded-full text-sm font-bold",children:[k,"s"]}),(0,s.jsx)("div",{className:"p-6 pt-14",children:y?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-center mb-6",children:el?(0,s.jsx)("h2",{className:"text-xl font-bold",children:"That's the end of the game! You can see your final cards below!"}):(0,s.jsxs)(s.Fragment,{children:[null!==R&&T&&(0,s.jsxs)("h3",{className:"text-lg font-semibold mb-1",children:[(0,s.jsxs)("span",{className:"text-gray-600",children:["Row ",M,", round ",R," - it's"," "]}),(0,s.jsx)("span",{className:"text-black",children:T}),(0,s.jsx)("span",{className:"text-gray-600",children:"!"})]}),"bullshit"===j?(0,s.jsxs)("h3",{className:"text-lg",children:["What's this?"," ",(0,s.jsx)("span",{className:"font-bold",children:null==Z?void 0:Z.to_player})," ","has called"," ",(0,s.jsx)("span",{className:"font-bold text-rose-600",children:"BULLSHIT"}),"! Select the card with the"," ",(0,s.jsx)("span",{className:"font-bold",children:"same"})," rank as the card in play below - or face drinking double!",H>0&&(0,s.jsxs)("span",{className:"text-gray-600 block mt-1",children:["By the way you already need to drink ",H," ","this round!"]})]}):"drink"===j?(0,s.jsxs)("h3",{className:"text-lg",children:[(0,s.jsx)("span",{className:"font-bold",children:null==Z?void 0:Z.from_player})," ","has asked you to drink! Decide what to do by choosing a button below."]}):"several_drink"===j?(0,s.jsxs)("h3",{className:"text-lg",children:["You have been called to drink by"," ",(0,s.jsx)("span",{className:"font-bold",children:"multiple"})," other players! We'll begin with"," ",(0,s.jsx)("span",{className:"font-bold",children:null==Z?void 0:Z.from_player}),". Decide what to do by choosing a button below."]}):(0,s.jsxs)("h3",{className:"text-lg",children:[j," ",H>0&&(0,s.jsxs)("span",{className:"font-semibold text-rose-600",children:["You need to drink ",H," this round!"]})]})]})}),(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(u,{cards:b,showAllCards:_,countdownActive:k>0,onCardSelect:B?eo:void 0})}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 mt-6",children:[V&&(0,s.jsxs)("button",{onClick:()=>{S(!0),X(!1),C(10),N("Remember your cards now! You will NOT be able to view them again!")},className:"bg-rose-500 hover:bg-rose-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center",children:["Show My Cards",(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})]}),q&&(0,s.jsxs)("button",{onClick:()=>{S(!0),J(!1),C(15),N("Remember your new card! You will NOT be able to view it again!")},className:"bg-rose-500 hover:bg-rose-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center",children:["Get New Card",(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})]}),D&&(0,s.jsxs)("button",{onClick:()=>{W(!0)},className:"bg-rose-500 hover:bg-rose-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center",children:["Select Player",(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})]})]}),K&&(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("button",{onClick:()=>en(!0),className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center",children:["Accept Drinks",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),(0,s.jsxs)("button",{onClick:()=>en(!1),className:"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center",children:["Bullshit!",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})]})]})]})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Waiting for host to continue..."}),G&&(0,s.jsxs)("button",{onClick:ei,className:"bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-8 rounded-full transition duration-300",children:["Start Game",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2 inline",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})}),(0,s.jsx)("div",{className:"text-center pb-6",children:(0,s.jsxs)(o(),{href:"/",className:"text-blue-500 hover:text-blue-700 transition duration-300",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"})}),"Exit Game"]})})]})}),P&&(0,s.jsx)(h,{players:l.filter(e=>e.uid!==n),onSelectPlayer:e=>{F(e)},selectedPlayer:O,onConfirm:er,onCancel:()=>{W(!1),F(null)},currentCard:T||""})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8,675,636,593,792],()=>t(284)),_N_E=e.O()}]);